# TI程序员计算器程序文档

## 一、**软件系统分析和设计方案**

### 1、需求分析

#### 1）问题重述

**基本要求**：设计德州仪器程序员专用计算器（1977 年-1982 年发布）。按照TI程序员计算器（1982 年LCD版本）的原始面板键盘和显示布局设计出计算器的交互窗口，参照计算器的功能介绍，基本要求只需要实现10 进制和16 进制的基础算术运算。即不含括号的单步加减乘除运算。
**提高要求**：参照计算器的功能介绍，实现输入的 10 进制数和16 进制数之间的相互转换；实现与、或、异或、反码、补码和移位运算；实现单一进制模式下的带括号的组合多步运算；实现混合进制模式下带括号的组合多步运算；设计运算溢出等出错提示。

<img src="pic/QQ截图20220529155216.png" style="zoom:67%;" />

#### 2）需求分析综述

**使用java语言，运用java.swing界面设计技术，设计具有图形交互界面的，混合进制算数逻辑运算计算器的桌面应用程序。**



**界面需求分析**：按照TI程序员计算器说明书给出的参考图片，复刻计算器界面。

**交互需求分析**：通过用户**鼠标点击**图形交互界面按钮，输入运算的操作数和操作符。

**功能需求分析**：通过问题综述，可以看出基本要求中的功能要求是提高要求问题的子集，总体上可以用**混合进制算数逻辑运算**高度概括，具体需求如下：

1. 计算器具有8个数位的输入与输出
2. 16进制采用有符号数补码表示
3. 10进制以及16进制下算数运算（加减乘除）
4. 16进制下逻辑运算（与、或、异或、移位、求反码、求补码）
5. 10进制小数运算
6. 10进制16进制进制转换
7. 使用括号对运算顺序进行改变

**错误信号分析：**错误信号大体可以分为**溢出**和**语法错误**

| 序号 | 错误类型    | 错误信号变量名称   | 错误信号解释                   | 错误信号常量值 |
| ---- | ----------- | ------------------ | ------------------------------ | -------------- |
| 1    | OF/溢出     | INPUT_OVERFLOW     | 输入溢出                       | 5              |
| 2    | OF/溢出     | OUTPUT_OVERFLOW    | 输出溢出                       | 6              |
| 3    | GE/语法错误 | HEX_INPUT_WHEN_DEX | 在10进制情况下 输入a-f         | 3              |
| 4    | GE/语法错误 | SC1_WHEN_DEC       | 在10进制的时候使用反码按钮     | 8              |
| 5    | GE/语法错误 | SC2_WHEN_DEC       | 在10进制的时候使用补码按钮     | 9              |
| 6    | GE/语法错误 | AND_WHEN_DEC       | 在10进制的时候使用与运算按钮   | 12             |
| 7    | GE/语法错误 | OR_WHEN_DEC        | 在10进制的时候使用或运算按钮   | 13             |
| 8    | GE/语法错误 | XOR_WHEN_DEC       | 在10进制的时候使用异或运算按钮 | 14             |
| 9    | GE/语法错误 | SHE_WHEN_DEC       | 在10进制的时候使用移位按钮     | 15             |
| 10   | GE/语法错误 | INPUT_DOT_WHEN_HEX | 在16进制输入小数点             | 4              |
| 11   | GE/语法错误 | NEGATIVE_WHEN_HEX  | 在16进制状态下使用减号充当符号 | 11             |
| 12   | GE/语法错误 | MISS_PARENTHESES   | 缺少括号                       | 7              |
| 13   | GE/语法错误 | PARENTHESES_ERROR  | 括号使用的语法错误             | 10             |
| 14   | GE/语法错误 | EQUAL_ERROR        | 等号触发的多种错误             | 16             |
| 15   | GE/语法错误 | DIVIDE_ZERO        | 除以0                          | 17             |



### 2、功能及指标分析

对于上述需求分析，可以得到具体的功能及指标分析：

#### **1）界面及交互**

界面根据大作业要求必须使用**java.swing图形界面开发工具**进行编写，由于功能和实际TI程序员计算器相比略有删减，所以交互界面会有略微变化，但风格尽可能和实物保持一致。由于真实计算器是通过用户手动按下按钮进行输入，计算器通过液晶显示屏输出计算结果、状态信号以及错误信号，所以本软件只支持用户使用**鼠标点击**触发相关的**输入操作**。输出方面，按照真实计算器文档指标，可以输出8位数码。

#### **2）计算器核心功能**

1. 由于输入输出的限制，计算器在**10进制**输入输出状态下支持-9999999~99999999的范围，**16进制**按照文档要求，可以输出等效二进制下**32位有符号数补码形式**，即正数0~7FFFFFFF(0 ~ 2147483647)；负数80000000~FFFFFFFF(-2147483648 ~ -1)。输入输出都有可能造成溢出，具体见**错误信号分析**部分。十进制可以使用负号（-）表示负数，十六进制使用符号位表示正负（以下不再区分正数负数）。
2. 10进制支持**整数、小数**的**加减乘除**运算，可以使用**括号**调整计算顺序。
3. 16进制只支持**整数**的**加减乘除**算术运算，以及逻辑运算**与、或、异或、移位、求反码、求补码**运算，可以使用**括号**对算数运算和逻辑运算（除求反码、求补码）的计算顺序进行调整。
4. 计算器支持10进制和16进制之间的**进制转换**，一个计算表达式可以是**混合进制输入**（混合进制包括了单一进制）

| 序号 | 符号 | 说明     |
| ---- | ---- | -------- |
| 1    | +    | 算数加   |
| 2    | -    | 算数减   |
| 3    | *    | 算数乘   |
| 4    | /    | 算数除   |
| 5    | &    | 逻辑与   |
| 6    | \|   | 逻辑或   |
| 7    | ^    | 逻辑异或 |
| 8    | <    | 逻辑移位 |
| 9    | =    | 等号     |
| 10   | 1'SC | 求反码   |
| 11   | 2'SC | 求补码   |

#### **3）错误信号**

由于输入输出限制，以及算数逻辑表达式的相关语法。

计算器可能会因为用户的非法输入产生**溢出类型错误**以及**语法错误**，如：输入溢出、10进制状态下使用十六进制补充操作数……

由于表达式的计算还可能产生如：输出溢出、除以0……等溢出类型错误和语法错误。

当错误信号**触发**，应该有相关信号展示，并且禁止用户的后续输入，只有当错误信号**消除**，才可以继续输入。

<img src="pic/QQ截图20220529165526.png" style="zoom: 50%;" />

### 3、系统设计方案

#### **1）界面设计方案**

java.swing界面设计方案可以通过直接编写代码完成，也可以使用集成开发环境中的java swing GUI设计工具包完成。对于课程学习，掌握swing类的继承关系，类的方法和属性，直接编写代码更加合适。对于工程项目，大量的交互组件和互相包含的容器组合，使用快速开发工具更加准确和方便。

对于本次项目，总共有35个按钮，4个信号输出位置，以及一个表达式输出窗口。组件繁多，容器互相嵌套，布局要求非常工整。所以选择了IDEA集成开发环境内置的**swing UI设计器**中的GUI窗体设计功能。

该功能类似Android开发中编写布局XML文件，只不过这里省去了对XML代码的直接编写，使用拖拽的方式进行布局。GUI窗体设计工具产生的.form文件是**XML资源文件**，里面使用了XML标签对象的格式对所有窗体、组件的布局等属性进行了标记。编写程序主类的时候会关联解析布局资源文件，按照布局的要求显示图形交互界面。

<img src="pic/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-05-30%20001235.png" style="zoom: 80%;" />

上图为GUI窗体工具包中的最终设计面板，下图为主要的容器嵌套树形关系

<img src="pic/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-05-30%20001409.png" style="zoom:67%;" />

在窗体中首先新建一个根容器root，分析可知，整个计算器可以分成三个大模块，从上到下依次为：**显示模块、信号显示模块、用户输入模块**。对于root根容器，使用GridLayoutManager对其进行布局。**GridLayoutManager**是IDEA集成开发环境推荐的布局管理方式，对于多行多列的表格形图形交互界面有很好的效果。

**显示模块**，整个模块使用一个JPanel封装，设置背景颜色background为白色。使用的组件是JLabel，用字符串的形式显示用户的输入和计算器的输出，可以在JLabel属性中设置horizontal size policy水平大小许可、font字体格式、foreground前景颜色（字体颜色）、以及JLabel类的类名。这里采用黑色作为字体颜色，水平大小可收缩、可增大。同时使用了一个水平分隔，放置在JLabel左侧，可以让不同位数的字符串始终出现在显示模块右侧。

![](pic/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-05-30%20003333.png)

**信号显示模块**，和显示模块类似，总共有4个JLabel，分别对应了10进制状态DEC、16进制状态HEX、溢出错误OF以及语法错误GE。由于需要在一行显示，这里整个信号显示模块的JPanel使用的是**FLowLayout**布局管理，设置属性horizontal align水平对齐方式为左侧对齐。对于四个信号，默认初始显示DEC，其他三个变量使用空格填充。如果使用setVisible属性设置，会导致全部左对齐，和真实硬件场景不符。

![](pic/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-05-30%20003455.png)

**用户输入模块**，对比原产品照片和当前软件需求可以知道，输入模块的按钮可以按照一个7*5的表格排列，但是中间的15位输入部分，背景颜色较为特殊，并且按钮上方有16进制对应的2进制编码，方便用户直接将16进制输出转换为2进制格式。

所以对于整个表格容器，选择GridLayoutManager作为布局管理，建立7*5的表格。合并中间5 * 3的表格，并且在其中嵌套一个JPanel，此嵌套JPanel同样是用GridLayoutManager作为布局管理，建立5*3的表格。中间的15个表格单元，再嵌套一个JPanel，同样使用GridLayoutManager作为布局管理，设置上下两行，上面一行放置一个JLabel作为二进制提示文本，下面一行放置一个JButton按钮，作为用户输入的焦点。5 * 3的表格外，其他表格单元按照排版要求放置相应的JButton，同时在需要的地方增加垂直分隔，以满足排版的美观。

对于35个按钮，都在其属性栏设置相应的对象名，设置了对象名的组件，集成开发环境会在主类代码中创建对象的私有成员，方便后续的事件处理。同时给按钮设置了默认显示文字，对应了真实计算器上按键的铭文。按照排版需求设置相应容器和按钮的背景颜色和前景文字颜色。为了交互的美观，对所有的JButton，取消勾选了borderPainted、focusCycleRoot、focusPainted、focusable等属性，使得点击按钮没有焦点框，阴影效果已经描边，让整体交互更加优雅。

<img src="pic/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-05-30%20005600.png" style="zoom:80%;" />



**最终成品图形交互界面截图如下：**

![](pic/QQ%E6%88%AA%E5%9B%BE20220530143720.png)



#### 2）**交互设计方案**

用户输入统一使用对按钮的**高级事件处理**，即点击按钮触发**输入**，用户输入会在显示模块显示，每次显示一个操作数或者是左右括号。每当用户输入一个操作符或者是左右括号，表示上一个操作数输入完毕。这样设计符合数学上算术逻辑表达式的语法，符合TI程序员计算器的说明文档，也符合当前市面上主流的计算器交互逻辑。同时我们增加了两个功能，**回退**按钮“<--”和**清空**按钮“CLC”，更加方便用户对当前输入进行修改。

当所有表达式输入完毕，用户点击**等号**，计算器在显示模块返回**输出**结果。

对于**取反码**和**取补码**这两个特殊的逻辑运算，按下后会立即对表达式进行重写，直接在显示模块反馈给用户。

当然，用户会由于操作失误导致错误输入，错误输入主要分为两大类型。一种是**溢出错误**，即用户输入了超过输入允许范围的操作数，或者是用户正确输入的计算结果超出了计算器正确的表示范围。另一种错误是**语法错误**，由于本计算器涉及到不同进制下的混合计算，很多操作符和操作数都有相应的使用范围，加上括号的引入以及传统的表达式语法错误。本计算器可能会收到相当多的用户错误输入，对于非致命错误，计算器会屏蔽对输入的响应，但是不会产生错误信号；对于致命的错误，有可能会使得计算器核心算法不能正确运行，计算器会给出错误信号，只有当用户消除了所有错误信号，才可以继续输入。

**这样将纷繁复杂是防止用户错误输入的工作交由事件处理解决，既符合了错误的产生和消除逻辑，又可以让算法设计在相对理想的环境下完成。**



#### **3）核心功能设计方案**

**混合进制计算器的输入方案**

由于计算器对用户输入操作数的个数没有限制，软件无法确定用户输入的个数，所以使用数组等方案记录操作数和操作符不是明智的选择。本软件所有的用户输入，在软件底层都会转化成字符串形式，为此定义了两个临时的字符串变量：

```java
    private String expression="";   //总表达式
    private String currentString="";   //当前需要展示在JLabel ans上字符串
```

currentString记录当前的操作数，expression记录总表达式。

根据需求分析，我们知道该计算器在一个表达式中的不同操作数可能来自不同的数制。例如我们可以输入这样的表达式：$123_{10}+2BC_{16}+123_{16}$，根据计算机组成原理以及数字电路对于数制的介绍，我们可以知道，不同的数制只是对于数的展示形式的不同，计算的结果都是等效的。所以所有16进制模式下输入的16进制数，都会在软件底层通过调用**16进制转10进制**的方法将16进制对应的10进制操作数输入到总表达式中。这样计算器算法只需要处理10进制下的操作。（具体算法分析见**软件实现和代码编写**）

```java
currentString=new Translation(currentString).Decimal();
expression+=currentString;
```



**计算器计算算法**



**进制转换方案**



**反码补码方案**





#### **4）错误触发及消除设计方案**





## 二、**软件实现和代码编写**

### 1、用户输入模块与事件处理

### 2、错误信号触发与消除机制

### 3、算法模块

算法模块具体见**算法分析**部分



## 三、**算法分析**

### 1、计算器计算算法分析

### 2、进制转换算法分析

### 3、反码、补码算法分析



## 四、**软件调试和测试**

### 1、软件测试

### 2、问题与解决方案



## 五、**参考文献和材料**



## 六、**团队成员姓名和联系方法**

**张宸冉**	邮箱：1604690196@qq.com	Github:Mr-Talon	

负责内容：图形交互界面设计，输入逻辑设计与异常输入拦截，项目统筹，文档图形交互界面、输入逻辑、错误信号部分

**梁涛**		邮箱：332604872@qq.com	  Github:3dfish2dweb

负责内容：计算器计算算法设计，文档计算器算法设计、分析、测试部分

**杨德宝**	邮箱：2495499315@qq.com	Github:Lyr3

负责内容：计算器进制转换算法设计，文档进制转换算法设计、分析、测试部分

**佘振东**	邮箱：2577484662@.qq.com	Github:fsbbts

负责内容：计算器反码补码算法设计，文档反码补码算法设计、分析、测试部分